"use strict";(globalThis.webpackChunksourcescribe_docs=globalThis.webpackChunksourcescribe_docs||[]).push([[2729],{8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(6540);const c={},d=i.createContext(c);function l(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),i.createElement(d.Provider,{value:n},e.children)}},9411:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>t,default:()=>r,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"api-reference/files/sourcescribe_watch_handler","title":"SourceScribe File Change Event Handler","description":"Overview","source":"@site/docs/api-reference/files/sourcescribe_watch_handler.md","sourceDirName":"api-reference/files","slug":"/api-reference/files/sourcescribe_watch_handler","permalink":"/sourcescribe-core/docs/api-reference/files/sourcescribe_watch_handler","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var c=s(4848),d=s(8453);const l={},t="SourceScribe File Change Event Handler",h={},a=[{value:"Overview",id:"overview",level:2},{value:"Main Components",id:"main-components",level:2},{value:"<code>ChangeHandler</code> Class",id:"changehandler-class",level:3},{value:"Initialization",id:"initialization",level:4},{value:"Event Handling Methods",id:"event-handling-methods",level:4},{value:"Change Handling Logic",id:"change-handling-logic",level:4},{value:"Dependencies and Imports",id:"dependencies-and-imports",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Implementation Details",id:"implementation-details",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"sourcescribe-file-change-event-handler",children:"SourceScribe File Change Event Handler"})}),"\n",(0,c.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," class in the ",(0,c.jsx)(n.code,{children:"handler.py"})," file is responsible for monitoring and handling file system change events in the SourceScribe project. It is designed to provide a flexible and efficient way to track modifications, creations, and deletions of files, and to notify a callback function when such changes occur."]}),"\n",(0,c.jsx)(n.h2,{id:"main-components",children:"Main Components"}),"\n",(0,c.jsxs)(n.h3,{id:"changehandler-class",children:[(0,c.jsx)(n.code,{children:"ChangeHandler"})," Class"]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," class is the main component of this file. It inherits from the ",(0,c.jsx)(n.code,{children:"FileSystemEventHandler"})," class provided by the ",(0,c.jsx)(n.code,{children:"watchdog"})," library, which allows it to listen for and respond to various file system events."]}),"\n",(0,c.jsx)(n.h4,{id:"initialization",children:"Initialization"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," class is initialized with the following parameters:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"callback"}),": A function to be called when changes are detected."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"debounce_seconds"}),": The number of seconds to wait before processing changes, to avoid unnecessary callbacks."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"include_patterns"}),": A set of file patterns to include in the monitoring process."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"exclude_patterns"}),": A set of file patterns to exclude from the monitoring process."]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"event-handling-methods",children:"Event Handling Methods"}),"\n",(0,c.jsxs)(n.p,{children:["The class overrides the following event handling methods from the ",(0,c.jsx)(n.code,{children:"FileSystemEventHandler"})," class:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"on_modified(self, event: FileSystemEvent) -> None"}),": Handles file modification events."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"on_created(self, event: FileSystemEvent) -> None"}),": Handles file creation events."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"on_deleted(self, event: FileSystemEvent) -> None"}),": Handles file deletion events."]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["These methods call the ",(0,c.jsx)(n.code,{children:"_handle_change()"})," method to process the file system events."]}),"\n",(0,c.jsx)(n.h4,{id:"change-handling-logic",children:"Change Handling Logic"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"_handle_change()"})," method is responsible for processing file system changes. It checks if the file matches the include and exclude patterns, and then adds the file path to the ",(0,c.jsx)(n.code,{children:"changed_files"})," set. It also updates the ",(0,c.jsx)(n.code,{children:"last_change_time"})," attribute to track the time of the last change."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"_should_process()"})," method is used to determine whether a file should be processed based on the include and exclude patterns."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"process_pending_changes()"})," method is responsible for processing the accumulated changes. It checks if the debounce time has elapsed, and if so, it calls the provided ",(0,c.jsx)(n.code,{children:"callback"})," function with the set of changed files."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"has_pending_changes()"})," method can be used to check if there are any pending changes that have not yet been processed."]}),"\n",(0,c.jsx)(n.h2,{id:"dependencies-and-imports",children:"Dependencies and Imports"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," class depends on the following imports:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"time"}),": For tracking the time of the last change."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"typing"}),": For type annotations."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"watchdog.events"}),": For the ",(0,c.jsx)(n.code,{children:"FileSystemEventHandler"})," and ",(0,c.jsx)(n.code,{children:"FileSystemEvent"})," classes."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"pathlib"}),": For working with file paths."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"sourcescribe.utils.logger"}),": For the ",(0,c.jsx)(n.code,{children:"get_logger()"})," function."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,c.jsxs)(n.p,{children:["Here's an example of how the ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," class can be used:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'from sourcescribe.watch.handler import ChangeHandler\n\ndef on_files_changed(changed_files: Set[str]):\n    for file_path in changed_files:\n        print(f"File changed: {file_path}")\n\nhandler = ChangeHandler(\n    callback=on_files_changed,\n    debounce_seconds=2.0,\n    include_patterns={\n        "*.py",\n        "*.md",\n    },\n    exclude_patterns={\n        "*__pycache__*",\n        "*.pyc",\n    },\n)\n\n# Start monitoring file system changes\nhandler.process_pending_changes()\n\n# Check for pending changes periodically\nwhile True:\n    if handler.has_pending_changes():\n        handler.process_pending_changes()\n    time.sleep(0.1)\n'})}),"\n",(0,c.jsxs)(n.p,{children:["In this example, the ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," is initialized with a callback function ",(0,c.jsx)(n.code,{children:"on_files_changed()"}),", which will be called whenever files are changed. The ",(0,c.jsx)(n.code,{children:"include_patterns"})," and ",(0,c.jsx)(n.code,{children:"exclude_patterns"})," parameters are used to specify which files should be monitored."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"process_pending_changes()"})," method is called to start the monitoring process, and the ",(0,c.jsx)(n.code,{children:"has_pending_changes()"})," and ",(0,c.jsx)(n.code,{children:"process_pending_changes()"})," methods are used to check for and process any pending changes."]}),"\n",(0,c.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," class uses the ",(0,c.jsx)(n.code,{children:"watchdog"})," library to monitor file system events. It maintains a set of changed files (",(0,c.jsx)(n.code,{children:"changed_files"}),") and the time of the last change (",(0,c.jsx)(n.code,{children:"last_change_time"}),"). The ",(0,c.jsx)(n.code,{children:"_handle_change()"})," method is responsible for adding file paths to the ",(0,c.jsx)(n.code,{children:"changed_files"})," set and updating the ",(0,c.jsx)(n.code,{children:"last_change_time"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"process_pending_changes()"})," method checks if the debounce time has elapsed since the last change, and if so, it calls the provided ",(0,c.jsx)(n.code,{children:"callback"})," function with the set of changed files. This helps to avoid unnecessary callbacks and improve the efficiency of the file monitoring process."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"_should_process()"})," method is used to determine whether a file should be processed based on the include and exclude patterns. This allows the ",(0,c.jsx)(n.code,{children:"ChangeHandler"})," to be configured to only monitor specific files or file types."]})]})}function r(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}}}]);